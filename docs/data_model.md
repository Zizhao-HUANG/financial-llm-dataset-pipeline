# Data Model

This document describes the data schema at each major stage of the pipeline: the Silver layer, the Gold layer, and the final Exported formats.

---

## 1. Silver Layer Data Model

The silver layer contains data that has been cleaned and standardized from its raw form. Data in this layer is stored in the `data_silver/` directory.

-   **Structure**: The data is partitioned by `interface_id`. Each interface's data is consolidated into a single Apache Parquet file. For example:
    ```
    data_silver/
    └── interface=stock_zh_a_hist/
        └── data.parquet
    ```
-   **Schema**: The exact schema of each silver table depends on the source, but the `Normalizer` enforces some key standards:
    -   Column names are mapped to a consistent, internal naming scheme (e.g., `开盘` becomes `open`).
    -   An `effective_date` column (`YYYY-MM-DD` format) is created to serve as the primary timestamp for the record.
    -   A `ticker` column is added if the data is stock-specific.

---

## 2. Gold Layer Data Model

The gold layer contains the final, model-ready dataset. The data is fully assembled, feature-engineered, and labeled. It is stored in the `data_gold/` directory, split into two components: features and labels.

### `features/features_gold.parquet`

This is the main feature table. It is a "wide" table where each row represents a single stock on a single day.

-   **Primary Key**: `(ticker, date)`
-   **Schema**:
    -   `ticker`: The stock identifier.
    -   `date`: The observation date.
    -   **Feature Columns**: The table contains numerous feature columns. These are generated by joining all the silver tables. To maintain clarity and avoid name collisions, feature columns are renamed using the convention `feat_{original_name}_{interface_id}`. For example, the `adj_close_hfq` column from the `stock_zh_a_hist` interface would become `feat_adj_close_hfq_stock_zh_a_hist` in the gold table (note: for very common features, this prefix/suffix may be omitted for simplicity).

### `labels/labels_gold.parquet`

This table contains the target variables that a model would be trained to predict.

-   **Primary Key**: `(ticker, date)`
-   **Schema**:
    -   `ticker`: The stock identifier.
    -   `date`: The observation date.
    -   `r_{h}d`: The calculated future return for a horizon of `h` trading days (e.g., `r_1d`, `r_5d`, `r_20d`). The return is measured in basis points (bps).
    -   `label_na_{h}d`: A flag (`1` or `0`) indicating if the corresponding future return could be calculated. A value of `1` means the label is missing and should be ignored during model training.

---

## 3. Exported Data Formats

The final data, after merging features and labels, is exported to the `exports/` directory in several text-based formats suitable for LLMs.

### CPT (Continued Pre-Training) Format

-   **File**: `exports/cpt/finset_cpt_[suffix].jsonl`
-   **Model**: A JSON Lines file where each line is a JSON object with a single `"text"` key. The value is a string containing all feature and label information for a given `(ticker, date)`. This format is used to help the model learn the patterns and vocabulary of financial data.

### SFT (Supervised Fine-Tuning) Format

-   **File**: `exports/sft/finset_sft_[suffix].jsonl`
-   **Model**: A JSON Lines file where each line is a JSON object with three keys:
    -   `"Instruction"`: A prompt telling the model what to do.
    -   `"Input"`: The features for a given `(ticker, date)`.
    -   `"Output"`: The target label (e.g., the 1-day future return).
    This format is used to train the model to perform a specific predictive task.

### TXT (Human-Readable) Format

-   **File**: `exports/txt/finset_[suffix]_preview.txt`
-   **Model**: A simple text file for easy inspection, with each record clearly showing the ticker, date, features, and the target label.
